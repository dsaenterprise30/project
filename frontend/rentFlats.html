<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>DSA Enterprise - Rent Properties Admin Panel</title>
    <link rel="icon" type="image/x-icon" href="img/DSA.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caprasimo&display=swap" rel="stylesheet">

<style>
    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: white;
}

html {
    scroll-behavior: smooth;
}

.navbar {
    background: #1e3a8a;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.logo a {
    text-decoration: none;
    color: inherit;
}

.logo {
    display: flex;
    align-items: center;
    gap: 1rem;
    font-size: 25px;
    color: #fff;
    background: transparent;
    cursor: pointer;
    font-family: "Caprasimo", serif;
    font-weight: 400;
    font-style: normal;
}

.logo span {
    background: transparent;
    vertical-align: middle;
}

.logo img {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.2);
    vertical-align: middle;
}

.nav-links {
    display: flex;
    list-style: none;
    gap: 2rem;
    align-items: center;
}

.nav-links a {
    color: white;
    text-decoration: none;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.nav-links a:hover {
    background: rgba(255, 255, 255, 0.1);
}

.hamburger {
    display: none;
    flex-direction: column;
    cursor: pointer;
    padding: 0.5rem;
}

.hamburger span {
    width: 25px;
    height: 3px;
    background: white;
    margin: 2px 0;
    transition: 0.3s;
    border-radius: 2px;
}

.search-section {
    background: white;
    padding: 2rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    border-bottom: 1px solid #e2e8f0;
}

.search-container {
    max-width: 1200px;
    margin: 0 auto;
}

.search-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #1e3a8a;
    margin-bottom: 1.5rem;
    text-align: center;
}

.search-form {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
    align-items: end;
    flex-wrap: nowrap;
}

.search-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    flex-grow: 1;
    min-width: 150px;
    transition: flex-grow 0.3s ease;
}

.search-group:focus-within {
    flex-grow: 1.5;
}

.search-label {
    font-weight: 500;
    color: #374151;
    font-size: 0.875rem;
    white-space: nowrap;
}

.search-input,
.dropdown-btn,
.search-btn {
    height: 50px;
}

.search-input {
    padding: 0.75rem 1rem;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    font-size: 1rem;
    transition: all 0.3s ease;
    outline: none;
    width: 100%;
}

.search-input:focus {
    border-color: #1e3a8a;
    box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
}

.dropdown {
    position: relative;
    cursor: pointer;
    width: 100%;
}

.dropdown-btn {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    background: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 1rem;
    color: #374151;
    transition: all 0.3s ease;
}

.dropdown-btn:hover,
.dropdown.active .dropdown-btn {
    border-color: #1e3a8a;
    box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
}

.dropdown-content {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 2px solid #1e3a8a;
    border-radius: 12px;
    margin-top: 0.25rem;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 100;
    max-height: 250px;
    overflow-y: auto;
}

.dropdown.active .dropdown-content {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.dropdown-option {
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: background 0.2s ease;
    border-bottom: 1px solid #f3f4f6;
}

.dropdown-option:last-child {
    border-bottom: none;
}

.dropdown-option:hover {
    background: #f8fafc;
}

.dropdown-option.selected {
    background: #1e3a8a;
    color: white;
}

.search-btn {
    padding: 0.75rem 2rem;
    background: linear-gradient(135deg, #1e3a8a, #3b82f6);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    flex-shrink: 0;
    min-width: 120px;
}

.search-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(30, 58, 138, 0.3);
}

.selected-filters {
    margin-top: 1rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.filter-tag {
    background: #eff6ff;
    color: #1e3a8a;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border: 1px solid #bae6fd;
}

.filter-tag .remove {
    cursor: pointer;
    width: 16px;
    height: 16px;
    background: #1e3a8a;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
}

.listings-section {
    margin: 20px auto;
    font-family: Arial, sans-serif;
    max-width: 1200px;
}

.property-container {
    margin-bottom: 40px;
    width: 100%;
}

.property-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.property-title {
    font-size: 24px;
    color: #333;
    text-align: left;
}

.property-counters {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    justify-content: center;
}

.counter-card {
    flex: 1;
    min-width: 250px;
    padding: 20px;
    background: #f8f8f8;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.counter-card h4 {
    font-size: 1.1rem;
    color: #555;
    margin-bottom: 8px;
}

.counter-card .count {
    font-size: 2rem;
    font-weight: 700;
    color: #1e3a8a;
}

.add-property-btn {
    background-color: #28a745;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.add-property-btn:hover {
    background-color: #218838;
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.property-table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px auto;
    table-layout: fixed;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    border-radius: 8px;
    display: table;
}

.property-table th,
.property-table td {
    border: 1px solid #ddd;
    padding: 12px;
    text-align: left;
    word-wrap: break-word;
}

.property-table th {
    background-color: #f2f2f2;
    color: #333;
    font-weight: bold;
}

.property-table tr:nth-child(even) {
    background-color: #f9f9f9;
}

.property-table tr:hover {
    background-color: #f1f1f1;
}

.property-table td {
    color: #555;
}

.actions-cell {
    white-space: nowrap;
}

.action-btn {
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    margin-right: 8px;
    color: white;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-weight: 600;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.action-btn:last-child {
    margin-right: 0;
}

.edit-btn {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
}

.delete-btn {
    background: linear-gradient(135deg, #ef4444, #dc2626);
}

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
}

.side-panel {
    height: 100%;
    width: 0;
    position: fixed;
    right: 0;
    top: 0;
    background: #fff;
    overflow-x: hidden;
    transition: 0.4s;
    box-shadow: -2px 0 8px rgba(0,0,0,0.2);
    z-index: 2000;
    padding: 0;
}

.panel-header {
    padding: 15px;
    background: linear-gradient(135deg, #1e3a8a, #3b82f6);
    color: #fff;
    font-size: 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 26px;
    cursor: pointer;
}

.panel-content {
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.panel-content label {
    margin: 8px 0 0;
    font-weight: 500;
    color: #555;
    font-size: 0.9rem;
}

.panel-content input,
.panel-content select {
    padding: 8px;
    font-size: 15px;
    border-radius: 6px;
    border: 1px solid #ccc;
    width: 100%;
}

.button-row {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.button-row button {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.3s;
}

#addPropertyForm .button-row button {
    background-color: #1e3a8a;
    color: white;
}

#addPropertyForm .button-row button:hover {
    background-color: #1a3274;
}

.overlay {
    position: fixed;
    display: none;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.4);
    z-index: 1500;
}

.input-with-clear {
    position: relative;
    width: 100%;
    display: flex;
    align-items: center;
}

.input-with-clear input {
    width: 100%;
    padding-right: 35px;
}

.input-with-clear .clear-btn {
    position: absolute;
    right: 10px;
    background: transparent;
    border: none;
    color: #9ca3af;
    font-size: 1.25rem;
    cursor: pointer;
    display: none;
}

.input-with-clear input:not(:placeholder-shown) + .clear-btn {
    display: block;
}

.custom-modal {
    position: fixed;
    z-index: 3000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    display: none;
    justify-content: center;
    align-items: center;
}

.modal-content {
    background-color: white;
    padding: 25px;
    border-radius: 12px;
    max-width: 400px;
    width: 90%;
    text-align: center;
    box-shadow: 0 8px 30px rgba(0,0,0,0.2);
    position: relative;
}

.modal-message {
    margin-bottom: 20px;
    font-size: 1.1rem;
    color: #333;
}

.modal-actions button {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    margin: 0 5px;
    transition: transform 0.2s;
}

.modal-actions button:hover {
    transform: translateY(-2px);
}

#okBtn {
    background: #1e3a8a;
    color: white;
}

#confirmYesBtn {
    background: #28a745;
    color: white;
}

#confirmNoBtn {
    background: #ef4444;
    color: white;
}

@media (max-width: 768px) {
    .navbar {
        padding: 1rem;
    }
    .nav-links {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background: #1e3a8a;
        flex-direction: column;
        padding: 1rem 0;
        gap: 20px;
    }
    .nav-links.active {
        display: flex;
    }
    .hamburger {
        display: flex;
    }
    .search-form {
        flex-wrap: wrap;
        align-items: stretch;
    }
    .search-group {
        min-width: unset;
        flex-grow: 1;
    }
    .search-btn {
        width: 100%;
    }
    .search-section {
        padding: 1.5rem 1rem;
    }
    .listings-section {
        margin: 10px;
        max-width: none;
        padding: 0 1rem;
    }
    .property-header {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
    }
    .add-property-btn {
        width: 100%;
    }
    .card-view {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    .card-item {
        background: #fff;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
    }
    .card-item .card-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 0;
        border-bottom: 1px dashed #e2e8f0;
        flex-wrap: wrap;
    }
    .card-item .card-row:last-child {
        border-bottom: none;
    }
    .card-item .card-label {
        font-weight: 600;
        font-size: 0.875rem;
        color: #374151;
    }
    .card-item .card-value {
        text-align: right;
        font-size: 1rem;
        color: #555;
    }
    .card-item .actions-cell {
        justify-content: flex-end;
        width: 100%;
        margin-top: 10px;
    }
}

#custom-popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1001;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

.custom-popup-card {
    background-color: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    width: 90%;
    max-width: 400px;
    text-align: center;
    transform: scale(0.9);
    transition: transform 0.3s ease;
}

.popup-hidden {
    visibility: hidden;
    opacity: 0;
}

.popup-visible {
    visibility: visible;
    opacity: 1;
}

.custom-popup-buttons {
    display: flex;
    justify-content: space-around;
    margin-top: 1.5rem;
}

.custom-popup-buttons .btn {
    width: 45%;
}

#tableView {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

@media (max-width: 812px) and (orientation: landscape),
       (max-width: 900px) and (orientation: landscape) {
    .listings-section, .property-container {
        font-size: 14px;
    }
    .property-table {
        table-layout: auto;
        min-width: 100%;
    }
    .property-table th,
    .property-table td {
        padding: 8px 8px;
        font-size: 0.88rem;
        line-height: 1.15;
        white-space: normal;
        word-break: break-word;
        hyphens: auto;
        vertical-align: middle;
    }
    .property-table th {
        font-size: 0.9rem;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        max-width: 120px;
    }
    .action-btn {
        padding: 6px 8px;
        font-size: 0.78rem;
        min-width: 36px;
        margin-right: 6px;
    }
    .actions-cell {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        align-items: center;
    }
    .card-item {
        padding: 10px;
    }
    .card-item .card-row {
        padding: 6px 0;
    }
    .card-item .card-label {
        font-size: 0.85rem;
    }
    .card-item .card-value {
        font-size: 0.92rem;
    }
    #tableView::-webkit-scrollbar {
        height: 8px;
    }
    #tableView::-webkit-scrollbar-thumb {
        background: rgba(0,0,0,0.12);
        border-radius: 8px;
    }
    .property-header { gap: 10px; }
    .property-counters { gap: 10px; }
}

@media (max-width: 420px) and (orientation: landscape) {
    .property-table th { max-width: 90px; }
    .property-table td { font-size: 0.82rem; padding: 6px 6px; }
    .search-btn { min-width: 100px; font-size: 0.9rem; padding: 8px 10px; }
}
</style>
</head>

<body>

<nav class="navbar">
     <div class="logo">
   <a onclick="history.back()">
     <i class="fas fa-arrow-left"></i>
   </a>
   <a>
     <img src="img/DSA.png" alt="Logo">
     <span>DSA Enterprise</span>
   </a>
</div>
    <ul class="nav-links">
        <li><a href="sellFlats.html">Sell Flats</a></li>
        <li><a href="admin-dashboard.html">Dashboard</a></li>
    </ul>
    <div class="hamburger"><span></span><span></span><span></span></div>
</nav>

<div id="custom-popup-overlay" class="popup-hidden">
        <div class="custom-popup-card">
            <div class="custom-popup-content">
                <h3 id="popup-title"></h3>
                <p id="popup-message"></p>
            </div>
            <div class="custom-popup-buttons">
                <button id="popup-ok-btn" class="btn">OK</button>
                <button id="popup-close-btn" class="btn">Close</button>
            </div>
        </div>
    </div>

<div id="propertyPanel" class="side-panel">
    <div class="panel-header">
        <span id="propertyPanelTitle">Add New Property</span>
        <button class="close-btn" id="closePropertyPanel">&times;</button>
    </div>
    <div class="panel-content">
        <form id="addPropertyForm" novalidate>
            <input type="hidden" id="propertyId" value="">
            <label for="propertyLocation">Location:</label>
            <select id="propertyLocation" name="location" required><option value="">Select a Location</option><option value="Borivali West">Borivali West</option><option value="Kandivali West">Kandivali West</option><option value="Malad West">Malad West</option><option value="Ram Mandir West">Ram Mandir West</option><option value="Goregaon West">Goregaon West</option><option value="Andheri West">Andheri West</option><option value="Vile Parle West">Vile Parle West</option></select>
            <label for="propertyType">Property Type:</label>
            <select id="propertyType" name="propertyType" required><option value="">Select a Property Type</option><option value="1 RK">1 RK</option><option value="1 BHK">1 BHK</option><option value="1.5 BHK">1.5 BHK</option><option value="2 BHK">2 BHK</option></select>
            <label for="propertyPrice">Rent:</label>
            <input type="text" id="propertyPrice" name="price" placeholder="e.g., ₹25,000" required>
            <label for="propertyName">Name:</label>
            <input type="text" id="propertyName" name="userName" placeholder="e.g., John Doe" required>
            <label for="propertyContact">Contact:</label>
            <input type="text" id="propertyContact" name="contact" placeholder="e.g., 9876543210" required>
            <label for="propertyDate">Listed on Date:</label>
            <input type="date" id="propertyDate" name="date" required>
            <label for="tenantType">Tenant Preference:</label>
            <select id="tenantType" name="tenantType" required><option value="">Select a Preference</option><option value="Any">Any</option><option value="Family">Family</option><option value="Bachelors">Bachelors</option></select>
            <label for="ownershipType">Ownership Type:</label>
            <select id="ownershipType" name="ownershipType" required><option value="">Select an Ownership Type</option><option value="Owner">Owner</option><option value="Agent">Agent</option></select>
            <div class="button-row"><button type="submit" id="submitPropertyBtn">Add Property</button></div>
        </form>
    </div>
</div>

<div id="overlay" class="overlay"></div>

<div id="customModal" class="custom-modal">
    <div class="modal-content">
        <p id="modalMessage" class="modal-message"></p>
        <div id="modalActions" class="modal-actions"><button id="okBtn">OK</button><button id="confirmYesBtn">Yes</button><button id="confirmNoBtn">No</button></div>
    </div>
</div>

<section class="search-section" id="home">
    <div class="search-container">
        <h2 class="search-title">Rent Properties</h2>
        <form class="search-form" onsubmit="return false;">
            <div class="search-group">
                <label class="search-label">Select Location</label>
                <div class="dropdown" id="location"><div class="dropdown-btn"><span>Select Location</span><i class="fas fa-chevron-down"></i></div><div class="dropdown-content"><div class="dropdown-option" data-value="Borivali West">Borivali West</div><div class="dropdown-option" data-value="Kandivali West">Kandivali West</div><div class="dropdown-option" data-value="Malad West">Malad West</div><div class="dropdown-option" data-value="Ram Mandir West">Ram Mandir West</div><div class="dropdown-option" data-value="Goregaon West">Goregaon West</div><div class="dropdown-option" data-value="Andheri West">Andheri West</div><div class="dropdown-option" data-value="Vile Parle West">Vile Parle West</div></div></div>
            </div>
            <div class="search-group">
                <label class="search-label">Property Type</label>
                <div class="dropdown" id="flatType"><div class="dropdown-btn"><span>Select Property Type</span><i class="fas fa-chevron-down"></i></div><div class="dropdown-content"><div class="dropdown-option" data-value="1 RK">1 RK</div><div class="dropdown-option" data-value="1 BHK">1 BHK</div><div class="dropdown-option" data-value="1.5 BHK">1.5 BHK</div><div class="dropdown-option" data-value="2 BHK">2 BHK</div></div></div>
            </div>
            <div class="search-group">
                <label class="search-label">Enter Rent</label>
                <div class="input-with-clear"><input type="text" class="search-input" id="price" placeholder="e.g., ₹25,000"><button type="button" class="clear-btn" data-target="price">&times;</button></div>
            </div>
            <div class="search-group">
                <label class="search-label">Enter Mobile No.</label>
                <div class="input-with-clear"><input type="text" class="search-input" id="mobile" placeholder="e.g., 9876543210"><button type="button" class="clear-btn" data-target="mobile">&times;</button></div>
            </div>
            <div class="search-group">
                <label class="search-label">Ownership Type</label>
                <div class="dropdown" id="ownershipType"><div class="dropdown-btn"><span>Select Ownership Type</span><i class="fas fa-chevron-down"></i></div><div class="dropdown-content"><div class="dropdown-option" data-value="Agent">Agent</div><div class="dropdown-option" data-value="Owner">Owner</div></div></div>
            </div>
            <button type="button" class="search-btn" id="searchBtn"><i class="fas fa-search"></i> Search</button>
        </form>
        <div class="selected-filters" id="selectedFilters"></div>
    </div>
</section>

<section class="listings-section">
    <div class="property-container">
        <div class="property-header">
            <h2 class="property-title">Listed Properties for Rent</h2>
            <button class="add-property-btn" id="addNewBtn"><i class="fas fa-plus"></i> Add New</button>
        </div>
        <div class="property-counters">
            <div class="counter-card"><h4>Total Properties</h4><div class="count" id="totalProperties">0</div></div>
            <div class="counter-card"><h4>Family Preferred</h4><div class="count" id="familyProperties">0</div></div>
            <div class="counter-card"><h4>Bachelors Preferred</h4><div class="count" id="bachelorProperties">0</div></div>
            <div class="counter-card"><h4>Agent Properties</h4><div class="count" id="agentProperties">0</div></div>
            <div class="counter-card"><h4>Owner Properties</h4><div class="count" id="ownerProperties">0</div></div>
        </div>
        <div id="tableView" style="display: none;"><table class="property-table"><thead id="propertiesHeader"><tr><th>Location</th><th>Type</th><th>Rent</th><th>Name</th><th>Contact</th><th>Date(MM/DD/YYYY)</th><th>Preference</th><th>Ownership Type</th><th>Actions</th></tr></thead><tbody id="propertiesBody"></tbody></table></div>
        <div id="cardView" class="card-view" style="display: none;"></div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const BASE_URL = 'https://real-estate-project-1-lps5.onrender.com/api/rentflats';
    let properties = [];

    // --- Custom Modal Functionality ---
    const customModal = document.getElementById('customModal');
    const modalMessage = document.getElementById('modalMessage');
    const okBtn = document.getElementById('okBtn');
    const confirmYesBtn = document.getElementById('confirmYesBtn');
    const confirmNoBtn = document.getElementById('confirmNoBtn');

   // Unified function to handle both alerts and confirmations
function showCustomPopup(message, isConfirm = false, callback = null, duration = 3000) {//here 3000 is shows the 3 second.
    modalMessage.textContent = message;

    if (isConfirm) {
        okBtn.style.display = 'none';
        confirmYesBtn.style.display = 'inline-block';
        confirmNoBtn.style.display = 'inline-block';
    } else {
        okBtn.style.display = 'inline-block';
        confirmYesBtn.style.display = 'none';
        confirmNoBtn.style.display = 'none';

        // Auto close for alert after specific duration
        setTimeout(() => {
            customModal.style.display = 'none';
            if (callback) callback(true);
        }, duration);
    }

    customModal.style.display = 'flex';

    okBtn.onclick = () => {
        customModal.style.display = 'none';
        if (callback) callback(true);
    };

    confirmYesBtn.onclick = () => {
        customModal.style.display = 'none';
        if (callback) callback(true);
    };

    confirmNoBtn.onclick = () => {
        customModal.style.display = 'none';
        if (callback) callback(false);
    };
}



    // --- UI Element References ---
    const hamburger = document.querySelector('.hamburger');
    const navLinks = document.querySelector('.nav-links');
    const propertyPanel = document.getElementById('propertyPanel');
    const addNewBtn = document.getElementById('addNewBtn');
    const closePropertyPanelBtn = document.getElementById('closePropertyPanel');
    const propertyForm = document.getElementById('addPropertyForm');
    const propertyIdInput = document.getElementById('propertyId');
    const overlay = document.getElementById('overlay');
    const propertiesBody = document.getElementById('propertiesBody');
    const tableView = document.getElementById('tableView');
    const cardView = document.getElementById('cardView');
    const dropdowns = document.querySelectorAll('.dropdown');
    const selectedFiltersContainer = document.getElementById('selectedFilters');
    const searchInputs = document.querySelectorAll('.search-input');
    const clearButtons = document.querySelectorAll('.clear-btn');
    const contactInput = propertyForm.elements['contact'];
    const userNameInput = propertyForm.elements['userName'];

    let filters = { location: null, flatType: null, price: null, mobile: null };

    // === JAVASCRIPT FOR UI AND FILTERS ===
    // API for User Fetching by Contact Number
    contactInput.addEventListener('blur', async () => {
        const contactVal = contactInput.value.trim();
        if (contactVal.length === 10) {
            try {
                const res = await fetch(`https://real-estate-project-1-lps5.onrender.com/api/users/findByContact/${contactVal}`);
                const data = await res.json();

                if (res.ok && data.fullName) {
                    userNameInput.value = data.fullName; 
                    showCustomPopup(`✅ Data is fetched successfully: ${data.message}`);
                } else if (res.status === 403) {
                    userNameInput.value = ""; 
                    showCustomPopup("⚠️ " + data.message); 
                    closePanel();
                } else {
                    userNameInput.value = "";
                    showCustomPopup("⚠️ " + data.message); 
                }
            } catch (err) {
                console.error("Error checking user:", err);
                showCustomPopup("❌ Error fetching user details: " + err.message);
            }
        }
    });


    async function fetchAndRenderProperties() {
        try {
            const accessToken = localStorage.getItem('token');
            if (!accessToken) { showCustomPopup("⚠️ Please log in as admin."); return; }
            const response = await fetch(`${BASE_URL}/all`, { headers: { 'Content-Type': 'application/json', 'authorization': `Bearer ${accessToken}` } });
            if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`); }
            const data = await response.json();
            properties = data.rentFlatsList || [];
            filterAndRender();
        } catch (error) {
            console.error("Error fetching rental properties:", error);
            showCustomPopup("❌ Could not fetch listings. Please log in again.");
        }
    }

    propertyForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        for (const element of propertyForm.elements) {
            if (element.required && !element.value) {
                showCustomPopup(`⚠️ Please fill out the "${element.labels[0].textContent.replace(':', '')}" field.`);
                return;
            }
        }
        const accessToken = localStorage.getItem('token');
        if (!accessToken) { showCustomPopup('❌ Authentication failed. Please log in again.'); return; }

        const formData = {
            location: propertyForm.elements['location'].value,
            propertyType: propertyForm.elements['propertyType'].value,
            price: propertyForm.elements['price'].value,
            name: propertyForm.elements['userName'].value,
            contact: propertyForm.elements['contact'].value,
            date: propertyForm.elements['date'].value,
            tenantType: propertyForm.elements['tenantType'].value,
            ownershipType: propertyForm.elements['ownershipType'].value
        };
        const propertyId = propertyIdInput.value;
        const isCreating = propertyId === '';
        const url = isCreating ? `${BASE_URL}/create` : `${BASE_URL}/update/${propertyId}`;
        const method = isCreating ? 'POST' : 'PUT';
         try {
            const response = await fetch(url, { 
                method, 
                headers: { 
                    'Content-Type': 'application/json', 
                    'authorization': `Bearer ${accessToken}` 
                }, 
                body: JSON.stringify(formData) 
            });

            // ✅ MODIFIED: Handle the 409 status code
            if (!response.ok) { 
                const errorData = await response.json().catch(() => ({ message: 'Failed to save data.' })); 
                
                // Check for the 409 Conflict status code and display its message
                if (response.status === 409) {
                    showCustomPopup(`❌ ${errorData.message}`);
                    return;
                }

                throw new Error(errorData.message); 
            }
            
            showCustomPopup(isCreating ? '✅ New rental property added!' : '✅ Rental property updated!');
            await fetchAndRenderProperties();
            closePanel();
            
        } catch (error) {
            console.error("Error submitting form:", error);
            showCustomPopup(`❌ An error occurred: ${error.message}`);
        }
    });

    document.querySelector('.listings-section').addEventListener('click', async (e) => {
        const editBtn = e.target.closest('.edit-btn');
        if (editBtn) {
            const property = properties.find(p => p.id === editBtn.dataset.id);
            if (property) {
                propertyIdInput.value = property.id;
                propertyForm.elements['location'].value = property.location;
                propertyForm.elements['propertyType'].value = property.propertyType;
                propertyForm.elements['price'].value = property.price.replace(/[₹,]/g, '');
                propertyForm.elements['userName'].value = property.userName;
                propertyForm.elements['contact'].value = property.contact;
                propertyForm.elements['date'].value = new Date(property.date).toISOString().substring(0, 10);
                propertyForm.elements['tenantType'].value = property.tenantType;
                propertyForm.elements['ownershipType'].value = property.ownershipType;
                document.getElementById('propertyPanelTitle').textContent = 'Edit Rental Property';
                document.getElementById('submitPropertyBtn').textContent = 'Save Changes';
                openPanel();
            }
        }
        const deleteBtn = e.target.closest('.delete-btn');
        if (deleteBtn) {
            showCustomPopup('⚠️ Are you sure you want to delete this rental property?', true, async (confirmed) => {
                if (confirmed) {
                    try {
                        const accessToken = localStorage.getItem('token');
                        if (!accessToken) { showCustomPopup('❌ Authentication error.'); return; }
                        const response = await fetch(`${BASE_URL}/delete/${deleteBtn.dataset.id}`, { method: 'DELETE', headers: { 'authorization': `Bearer ${accessToken}` } });
                        if (!response.ok) throw new Error('Failed to delete property.');
                        showCustomPopup('✅ Rental property deleted successfully!');
                        await fetchAndRenderProperties();
                    } catch (error) {
                        console.error("Error deleting property:", error);
                        showCustomPopup("❌ Failed to delete rental property.");
                    }
                }
            });
        }
    });

    function getFilteredData() {
        return properties.filter(p => {
            // Location and Type filters (unchanged)
            if (filters.location && p.location !== filters.location.value) return false;
            if (filters.flatType && p.propertyType !== filters.flatType.value) return false;
            if (filters.ownershipType) {
                const ownershipValue = p.ownershipType || 'Agent'; // Treat blank as Agent
                if (ownershipValue !== filters.ownershipType.value) return false;
            }

            // --- MODIFIED RENT FILTER LOGIC ---
            if (filters.price && filters.price.value) {
                // Convert filter input and property price to numbers for comparison
                const filterPrice = parseInt(filters.price.value.replace(/[^0-9]/g, ''), 10);
                const propertyPrice = parseInt(p.price.replace(/[^0-9]/g, ''), 10);

                // Check if both are valid numbers and if the property's price is greater than the filter
                if (!isNaN(filterPrice) && !isNaN(propertyPrice) && propertyPrice > filterPrice) {
                    return false; 
                }
            }
            // --- END OF MODIFICATION ---
            
            // Mobile number filter (unchanged)
            if (filters.mobile && filters.mobile.value && !p.contact.includes(filters.mobile.value)) return false;
            
            return true;
        });
    }
    
    // --- rotation logic uses width + orientation (portrait => cards on mobile) ---
    function filterAndRender() {
        const filteredData = getFilteredData();

        // Use both width and orientation:
        const isMobile = window.innerWidth < 769;
        const isPortrait = window.matchMedia("(orientation: portrait)").matches;

        // Show cards only on mobile + portrait. Table otherwise (desktop or landscape).
        const showCards = isMobile && isPortrait;

        tableView.style.display = showCards ? 'none' : 'block';
        cardView.style.display = showCards ? 'flex' : 'none';

        if (showCards) renderCards(filteredData); else renderTable(filteredData);
        updateCounters(filteredData);
    }
    // --- end updated rotation logic ---

    function renderTable(data) {
        propertiesBody.innerHTML = '';
        data.forEach(prop => {
            const row = propertiesBody.insertRow();
            let contact = String(prop.contact || '');
            if (contact && contact.startsWith('91')) {
                contact = contact.replace('91', '+91 ');
            }
            row.innerHTML = `<td>${prop.location || ''}</td><td>${prop.propertyType || ''}</td><td>${prop.price || ''}</td><td>${prop.userName || ''}</td><td>${contact}</td><td>${new Date(prop.date).toLocaleDateString()}</td><td>${prop.tenantType || ''}</td><td>${prop.ownershipType || 'Agent'}</td><td class="actions-cell"><button class="action-btn edit-btn" data-id="${prop.id}"><i class="fas fa-edit"></i></button><button class="action-btn delete-btn" data-id="${prop.id}"><i class="fas fa-trash-alt"></i></button></td>`;
        });
    }

    function renderCards(data) {
        cardView.innerHTML = '';
        data.forEach(prop => {
            const card = document.createElement('div');
            card.className = 'card-item';
            let contact = String(prop.contact || '');
            if (contact && contact.startsWith('91')) {
                contact = contact.replace('91', '+91 ');
            }
            card.innerHTML = `<div class="card-row"><span class="card-label">Location:</span> <span class="card-value">${prop.location}</span></div><div class="card-row"><span class="card-label">Type:</span> <span class="card-value">${prop.propertyType}</span></div><div class="card-row"><span class="card-label">Rent:</span> <span class="card-value">${prop.price}</span></div><div class="card-row"><span class="card-label">Name:</span> <span class="card-value">${prop.userName}</span></div><div class="card-row"><span class="card-label">Contact:</span> <span class="card-value">${contact}</span></div><div class="card-row"><span class="card-label">Date:</span> <span class="card-value">${new Date(prop.date).toLocaleDateString()}</span></div><div class="card-row"><span class="card-label">Preference:</span> <span class="card-value">${prop.tenantType}</span></div><div class="card-row"><span class="card-label">Ownership Type:</span> <span class="card-value">${prop.ownershipType || 'Agent'}</span></div><div class="card-actions actions-cell"><button class="action-btn edit-btn" data-id="${prop.id}"><i class="fas fa-edit"></i></button><button class="action-btn delete-btn" data-id="${prop.id}"><i class="fas fa-trash-alt"></i></button></div>`;
            cardView.appendChild(card);
        });
    }

    function updateCounters(data) {
        document.getElementById('totalProperties').textContent = data.length;
        document.getElementById('familyProperties').textContent = data.filter(p => p.tenantType === 'Family').length;
        document.getElementById('bachelorProperties').textContent = data.filter(p => p.tenantType === 'Bachelors').length;
        document.getElementById('agentProperties').textContent = data.filter(p => p.ownershipType === 'Agent' || !p.ownershipType).length;
        document.getElementById('ownerProperties').textContent = data.filter(p => p.ownershipType === 'Owner').length;
    }

    function openPanel() { propertyPanel.style.width = '320px'; overlay.style.display = 'block'; }
    function closePanel() { propertyPanel.style.width = '0'; overlay.style.display = 'none'; }
    addNewBtn.addEventListener('click', () => { propertyForm.reset(); propertyIdInput.value = ''; document.getElementById('propertyPanelTitle').textContent = 'Add New Rental Property'; document.getElementById('submitPropertyBtn').textContent = 'Add Property'; openPanel(); });
    closePropertyPanelBtn.addEventListener('click', closePanel);
    overlay.addEventListener('click', closePanel);
    hamburger.addEventListener('click', () => navLinks.classList.toggle('active'));
    window.addEventListener('resize', filterAndRender);
    window.matchMedia("(orientation: portrait)").addEventListener('change', filterAndRender);

    dropdowns.forEach(dropdown => {
        const btn = dropdown.querySelector('.dropdown-btn');
        const options = dropdown.querySelectorAll('.dropdown-option');
        btn.addEventListener('click', (e) => { e.stopPropagation(); dropdowns.forEach(d => { if(d !== dropdown) d.classList.remove('active'); }); dropdown.classList.toggle('active'); });
        options.forEach(option => {
            option.addEventListener('click', (e) => { e.stopPropagation(); btn.querySelector('span').textContent = option.textContent; options.forEach(opt => opt.classList.remove('selected')); option.classList.add('selected'); filters[dropdown.id] = { value: option.dataset.value, text: option.textContent }; dropdown.classList.remove('active'); updateSelectedFilters(); filterAndRender(); });
        });
    });

    document.addEventListener('click', () => dropdowns.forEach(d => d.classList.remove('active')));

    searchInputs.forEach(input => {
        input.addEventListener('input', () => { filters[input.id] = { value: input.value, text: input.value }; updateSelectedFilters(); filterAndRender(); });
    });

    clearButtons.forEach(button => {
        button.addEventListener('click', () => { const targetId = button.dataset.target; document.getElementById(targetId).value = ''; filters[targetId] = null; updateSelectedFilters(); filterAndRender(); });
    });

    // --- QUICK-FIX: replace updateSelectedFilters to avoid id collision with form elements ---
    function updateSelectedFilters() {
        selectedFiltersContainer.innerHTML = '';

        // default labels for resetting dropdowns / inputs
        const defaultLabels = {
            location: 'Select Location',
            flatType: 'Select Property Type',
            ownershipType: 'Select Ownership Type',
            price: 'Enter Rent',
            mobile: 'Enter Mobile No.'
        };

        Object.keys(filters).forEach(key => {
            if (filters[key] && filters[key].value) {
                const tag = document.createElement('div');
                tag.className = 'filter-tag';
                tag.innerHTML = `<span>${filters[key].text}</span><div class="remove" data-filter="${key}">×</div>`;
                selectedFiltersContainer.appendChild(tag);
            }
        });

        selectedFiltersContainer.querySelectorAll('.remove').forEach(remove => {
            remove.addEventListener('click', (e) => {
                const filterKey = e.target.dataset.filter;
                filters[filterKey] = null;

                // FIRST: try to find the search dropdown with this id (the UI dropdowns have class 'dropdown')
                const dropdownDiv = document.querySelector(`.dropdown#${filterKey}`);
                if (dropdownDiv) {
                    const labelSpan = dropdownDiv.querySelector('.dropdown-btn span');
                    if (labelSpan) labelSpan.textContent = defaultLabels[filterKey] || 'Select';
                    dropdownDiv.querySelectorAll('.dropdown-option').forEach(opt => opt.classList.remove('selected'));
                }

                // SECOND: if there's also an input/select with the same id (form fields), reset its value safely
                const inputElem = document.getElementById(filterKey);
                if (inputElem && (inputElem.tagName === 'INPUT' || inputElem.tagName === 'TEXTAREA' || inputElem.tagName === 'SELECT')) {
                    // Only clear if it's not the dropdown we already handled
                    // (we already targeted the .dropdown element above, so this will target form fields)
                    inputElem.value = '';
                }

                updateSelectedFilters();
                filterAndRender();
            });
        });
    }
    // --- end quick-fix ---

    fetchAndRenderProperties();
});
</script>

</body>
</html>
